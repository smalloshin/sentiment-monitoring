<!doctype html>
<html lang="zh-TW">

<head>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="An interactive opinion monitoring system for diplomatic sentiment analysis with multi-dimensional stance assessment.">
    <meta charset="utf8">
    <title>Diplomatic Sentiment Analysis: Interactive Opinion Monitoring System</title>

    <link rel="stylesheet" href="fonts/stylesheet.css">
    <link rel="stylesheet" href="css/style.css">
    
    <!-- D3.js for visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <!-- Plotly.js for advanced charts -->
    <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>

    <script type="text/javascript" async
        src="https://xploreqa.ieee.org/xploreAssets/MathJax-274/MathJax.js?config=default">
        </script>

    <style>
        .interactive-container {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
        }

        .dimension-slider {
            display: flex;
            align-items: center;
            gap: 15px;
            margin: 15px 0;
            padding: 10px;
            background: white;
            border-radius: 6px;
        }

        .dimension-label {
            width: 140px;
            font-weight: 600;
            font-size: 0.9em;
        }

        .slider {
            flex: 1;
            height: 8px;
            border-radius: 5px;
            background: #e0e0e0;
            outline: none;
            -webkit-appearance: none;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1976d2;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #1976d2;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .slider-value {
            width: 50px;
            text-align: right;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .timeline-container {
            margin: 30px 0;
            padding: 20px;
            background: white;
            border-radius: 8px;
        }

        .timeline-bar {
            width: 100%;
            height: 60px;
            background: linear-gradient(to right, #1976d2, #d32f2f, #f57c00, #388e3c);
            border-radius: 8px;
            position: relative;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .timeline-handle {
            position: absolute;
            top: -8px;
            width: 30px;
            height: 76px;
            background: white;
            border: 3px solid #1976d2;
            border-radius: 4px;
            cursor: grab;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
            transition: all 0.2s ease;
        }

        .timeline-handle:active {
            cursor: grabbing;
        }

        .timeline-label {
            position: absolute;
            top: 70px;
            font-size: 0.85em;
            font-weight: 600;
            transform: translateX(-50%);
            left: 50%;
        }

        .score-bar {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
        }

        .score-label {
            width: 120px;
            font-size: 0.9em;
            font-weight: 600;
        }

        .score-fill {
            flex: 1;
            height: 20px;
            background: #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
            position: relative;
        }

        .score-value {
            height: 100%;
            background: linear-gradient(to right, #1976d2, #42a5f5);
            border-radius: 10px;
            transition: width 0.6s ease-out;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            color: white;
            font-size: 0.75em;
            font-weight: bold;
        }

        .score-number {
            width: 50px;
            text-align: right;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }

        .search-box {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .search-box input {
            flex: 1;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 6px;
            font-size: 0.95em;
        }

        .search-box button {
            padding: 10px 20px;
            background: #1976d2;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s ease;
        }

        .search-box button:hover {
            background: #1565c0;
        }

        .sentence-result {
            background: white;
            padding: 15px;
            border-left: 4px solid #1976d2;
            margin: 10px 0;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .sentence-text {
            font-size: 1em;
            line-height: 1.6;
            margin-bottom: 12px;
            color: #333;
        }

        .sentence-meta {
            font-size: 0.85em;
            color: #666;
            margin-bottom: 10px;
        }

        .alert-box {
            padding: 15px;
            margin: 15px 0;
            border-radius: 6px;
            border-left: 4px solid;
        }

        .alert-high {
            background: #ffebee;
            border-color: #d32f2f;
            color: #b71c1c;
        }

        .alert-medium {
            background: #fff3e0;
            border-color: #f57c00;
            color: #e65100;
        }

        .alert-low {
            background: #e8f5e9;
            border-color: #388e3c;
            color: #1b5e20;
        }

        .radar-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }

        .framed {
            border: 1px solid #1976d2;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            background: #f5f5f5;
        }

        .eyebrow {
            color: #1976d2;
            font-weight: 600;
            margin-bottom: 15px;
            font-size: 0.95em;
        }

        .caption {
            font-size: 0.85em;
            color: #666;
            margin-top: 15px;
            font-style: italic;
        }
    </style>
</head>

<body>
    <article class="mt-lg">
        <header>
            <div class="container">
                <h1>Diplomatic Sentiment Analysis: Interactive Opinion Monitoring System</h1>

                <p class="subhead">
                    This immersive article presents an interactive opinion monitoring system for real-time assessment of diplomatic positioning. Readers can explore how political stances evolve across eight dimensions, adjust dimensional weights to understand policy positioning, search for specific diplomatic statements, and identify anomalous shifts indicating potential policy changes.
                </p>

                <div class="header-info">
                    <div class="header-left box">
                        <div class="header-authors">
                            <h2>Authors</h2>
                            <ul>
                                <li>Political Analysis Research Team</li>
                                <li>International Relations Institute</li>
                            </ul>
                        </div>
                        <div class="header-published">
                            <h2>Published</h2>
                            <p>February 2026</p>
                        </div>
                    </div>

                    <div class="header-legend">
                        <svg class="click-icon" data-name="Click" xmlns="http://www.w3.org/2000/svg"
                            viewBox="0 0 83.62 122.88">
                            <title>Click</title>
                            <path
                                d="M40.59,14.63a3.36,3.36,0,0,1-1,2.39l0,0a3.39,3.39,0,0,1-4.77,0,3.42,3.42,0,0,1-1-2.4V3.39A3.4,3.4,0,0,1,37.2,0a3.34,3.34,0,0,1,2.39,1,3.39,3.39,0,0,1,1,2.4V14.63Z" />
                        </svg>
                        <p>Indicates interactive elements</p>
                    </div>
                </div>

                <div class="contents box">
                    <h2>Contents:</h2>
                    <ul>
                        <li><a href="#component1">Component 1: Timeline Explorer</a><span class="separator">&nbsp;&nbsp;|&nbsp;&nbsp;</span></li>
                        <li><a href="#component2">Component 2: Dimensional Weight Adjuster</a><span class="separator">&nbsp;&nbsp;|&nbsp;&nbsp;</span></li>
                        <li><a href="#component3">Component 3: Sentence Search & Scoring</a><span class="separator">&nbsp;&nbsp;|&nbsp;&nbsp;</span></li>
                        <li><a href="#component4">Component 4: Anomaly Detection</a></li>
                    </ul>
                </div>
            </div>
        </header>

        <div class="container mt-lg">

            <!-- Component 1: Timeline Explorer -->
            <section id="component1">
                <h2>Interactive Component 1: Timeline Explorer</h2>
                <p>
                    Drag the timeline handle to explore how diplomatic positioning evolves across 2005-2024. The timeline shows the temporal distribution of assertiveness, coerciveness, nationalism, and cooperation dimensions. Observe how major diplomatic events (Scarborough Shoal incident in 2012, South China Sea arbitration in 2016) correspond to shifts in dimensional scores.
                </p>

                <div class="framed" style="border: 1px solid #1976d2;">
                    <div class="eyebrow">互動元件 1：時間軸探索器 (Timeline Explorer)</div>
                    
                    <div class="timeline-container">
                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600;">選擇時間範圍：</label>
                            <div class="timeline-bar" id="timelineBar">
                                <div class="timeline-handle" id="timelineHandle" style="left: 50%;">
                                    <div class="timeline-label" id="timelineLabel">2014</div>
                                </div>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                            <div>
                                <h4 style="color: #1976d2; margin-bottom: 15px;">Assertiveness & Coerciveness</h4>
                                <div id="timelineChart1" style="width: 100%; height: 300px;"></div>
                            </div>
                            <div>
                                <h4 style="color: #1976d2; margin-bottom: 15px;">Nationalism & Cooperation</h4>
                                <div id="timelineChart2" style="width: 100%; height: 300px;"></div>
                            </div>
                        </div>

                        <div style="background: #f0f4f8; padding: 15px; border-radius: 8px; margin-top: 20px;">
                            <strong>Selected Year Scores:</strong>
                            <div id="yearScoresDisplay" style="margin-top: 10px; font-family: monospace; line-height: 1.8;"></div>
                        </div>
                    </div>

                    <div class="caption">
                        <b>Figure 1:</b> Timeline explorer showing temporal evolution of diplomatic positioning. Drag the handle to select different years and observe dimensional score changes.
                    </div>
                </div>
            </section>

            <!-- Component 2: Dimensional Weight Adjuster -->
            <section id="component2">
                <h2>Interactive Component 2: Dimensional Weight Adjuster</h2>
                <p>
                    Adjust the weights of each dimension to understand how different aspects of diplomatic positioning contribute to overall policy stance. The system recalculates a composite "Policy Positioning Index" in real-time as you adjust the sliders. This demonstrates how weighting different dimensions reveals different interpretations of diplomatic strategy.
                </p>

                <div class="framed" style="border: 1px solid #d32f2f;">
                    <div class="eyebrow" style="color: #d32f2f;">互動元件 2：維度權重調整器 (Dimensional Weight Adjuster)</div>
                    
                    <div class="interactive-container">
                        <p style="margin-bottom: 20px;">
                            調整下列8個維度的權重，系統將實時計算「政策立場指數」(Policy Positioning Index)。觀察不同的權重組合如何改變整體政策立場的評估。
                        </p>

                        <div id="dimensionSliders"></div>

                        <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 8px; margin-top: 30px;">
                            <h4 style="margin-top: 0;">Policy Positioning Index (PPI)</h4>
                            <div style="font-size: 2.5em; font-weight: bold; margin: 15px 0;" id="ppiValue">0.50</div>
                            <div style="font-size: 0.9em; opacity: 0.9;">
                                <span id="ppiInterpretation">Balanced positioning between assertiveness and cooperation</span>
                            </div>
                        </div>

                        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 30px;">
                            <div>
                                <h5 style="color: #1976d2; margin-bottom: 15px;">Dimensional Contributions</h5>
                                <div id="dimensionRadar" style="width: 100%; height: 300px;"></div>
                            </div>
                            <div>
                                <h5 style="color: #1976d2; margin-bottom: 15px;">Weight Distribution</h5>
                                <div id="weightChart" style="width: 100%; height: 300px;"></div>
                            </div>
                        </div>
                    </div>

                    <div class="caption">
                        <b>Figure 2:</b> Dimensional weight adjuster showing how different weightings of the eight dimensions affect the overall Policy Positioning Index. Adjust sliders to explore different interpretations of diplomatic strategy.
                    </div>
                </div>
            </section>

            <!-- Component 3: Sentence Search & Scoring -->
            <section id="component3">
                <h2>Interactive Component 3: Sentence Search & Detailed Scoring</h2>
                <p>
                    Search for specific diplomatic statements or keywords to view detailed multi-dimensional scoring. The system displays the sentence, its metadata (date, source), and a comprehensive breakdown of scores across all eight dimensions with LLM-generated explanations.
                </p>

                <div class="framed" style="border: 1px solid #388e3c;">
                    <div class="eyebrow" style="color: #388e3c;">互動元件 3：句子搜索與評分展示 (Sentence Search & Scoring)</div>
                    
                    <div class="interactive-container">
                        <div class="search-box">
                            <input type="text" id="sentenceSearch" placeholder="搜索句子或關鍵字 (例如：黃岩島、南海、合作)">
                            <button onclick="performSearch()">搜索</button>
                            <button onclick="clearSearch()" style="background: #999;">清除</button>
                        </div>

                        <div id="searchResults"></div>

                        <div id="detailedScoring" style="display: none; margin-top: 30px;">
                            <div style="background: white; padding: 20px; border-radius: 8px; border-left: 4px solid #1976d2;">
                                <h4 style="color: #1976d2; margin-top: 0;">詳細評分 (Detailed Scoring)</h4>
                                
                                <div style="background: #f5f5f5; padding: 15px; border-radius: 6px; margin-bottom: 20px;">
                                    <strong>句子：</strong>
                                    <p id="detailedSentence" style="margin: 10px 0; line-height: 1.6; font-style: italic;"></p>
                                </div>

                                <div id="detailedDimensionScores"></div>
                            </div>
                        </div>
                    </div>

                    <div class="caption">
                        <b>Figure 3:</b> Sentence search and detailed scoring interface. Search for specific statements to view comprehensive multi-dimensional assessment with explanations.
                    </div>
                </div>
            </section>

            <!-- Component 4: Anomaly Detection -->
            <section id="component4">
                <h2>Interactive Component 4: Anomaly Detection & Early Warning</h2>
                <p>
                    The system identifies significant deviations from baseline patterns, enabling early detection of policy shifts. This component displays anomalous scoring patterns that may indicate escalation, de-escalation, or strategic repositioning. High-severity anomalies suggest potential policy changes requiring policy attention.
                </p>

                <div class="framed" style="border: 1px solid #f57c00;">
                    <div class="eyebrow" style="color: #f57c00;">互動元件 4：異常檢測與預警 (Anomaly Detection & Early Warning)</div>
                    
                    <div class="interactive-container">
                        <div style="margin-bottom: 20px;">
                            <label style="font-weight: 600;">異常嚴重程度篩選：</label>
                            <div style="display: flex; gap: 10px; margin-top: 10px;">
                                <button onclick="filterAnomalies('all')" style="padding: 8px 16px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer;">全部</button>
                                <button onclick="filterAnomalies('high')" style="padding: 8px 16px; background: #d32f2f; color: white; border: none; border-radius: 4px; cursor: pointer;">高</button>
                                <button onclick="filterAnomalies('medium')" style="padding: 8px 16px; background: #f57c00; color: white; border: none; border-radius: 4px; cursor: pointer;">中</button>
                                <button onclick="filterAnomalies('low')" style="padding: 8px 16px; background: #388e3c; color: white; border: none; border-radius: 4px; cursor: pointer;">低</button>
                            </div>
                        </div>

                        <div id="anomalyList"></div>

                        <div style="background: #f0f4f8; padding: 20px; border-radius: 8px; margin-top: 20px;">
                            <h4 style="color: #1976d2; margin-top: 0;">異常模式分析 (Anomaly Pattern Analysis)</h4>
                            <div id="anomalyStats" style="display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 15px;"></div>
                        </div>
                    </div>

                    <div class="caption">
                        <b>Figure 4:</b> Anomaly detection and early warning system. Identifies significant deviations from baseline patterns indicating potential policy shifts. Filter by severity to focus on high-priority alerts.
                    </div>
                </div>
            </section>

        </div>

    </article>

    <script>
        // ============ DATA ============
        const YEARS = [2005, 2006, 2007, 2008, 2009, 2010, 2011, 2012, 2013, 2014, 2015, 2016, 2017, 2018, 2019, 2020, 2021, 2022, 2023, 2024];
        
        const TEMPORAL_DATA = {
            assertiveness: [0.42, 0.43, 0.41, 0.40, 0.39, 0.41, 0.44, 0.68, 0.65, 0.62, 0.58, 0.52, 0.50, 0.48, 0.50, 0.58, 0.60, 0.59, 0.58, 0.60],
            coerciveness: [0.35, 0.36, 0.34, 0.33, 0.32, 0.34, 0.37, 0.62, 0.60, 0.58, 0.48, 0.38, 0.35, 0.32, 0.35, 0.48, 0.50, 0.48, 0.45, 0.48],
            nationalism: [0.58, 0.59, 0.57, 0.56, 0.55, 0.57, 0.60, 0.72, 0.70, 0.68, 0.65, 0.60, 0.58, 0.56, 0.58, 0.65, 0.68, 0.67, 0.65, 0.68],
            interest: [0.62, 0.63, 0.61, 0.60, 0.59, 0.61, 0.64, 0.75, 0.73, 0.70, 0.68, 0.62, 0.60, 0.58, 0.60, 0.68, 0.70, 0.69, 0.68, 0.70],
            power: [0.48, 0.49, 0.47, 0.46, 0.45, 0.47, 0.50, 0.65, 0.63, 0.60, 0.58, 0.52, 0.50, 0.48, 0.50, 0.58, 0.60, 0.59, 0.58, 0.60],
            coop: [0.58, 0.57, 0.59, 0.60, 0.61, 0.59, 0.56, 0.22, 0.25, 0.28, 0.35, 0.72, 0.75, 0.78, 0.75, 0.55, 0.52, 0.54, 0.55, 0.52],
            compete: [0.28, 0.29, 0.27, 0.26, 0.25, 0.27, 0.30, 0.45, 0.48, 0.50, 0.48, 0.38, 0.35, 0.32, 0.35, 0.52, 0.55, 0.54, 0.52, 0.55]
        };

        const DIMENSIONS = [
            { id: 'assertiveness', name: 'Assertiveness (強硬度)', color: '#1976d2' },
            { id: 'coerciveness', name: 'Coerciveness (脅迫性)', color: '#d32f2f' },
            { id: 'nationalism', name: 'Nationalism (民族主義)', color: '#f57c00' },
            { id: 'interest', name: 'National Interest (國家利益)', color: '#388e3c' },
            { id: 'power', name: 'Relative Power (相對實力)', color: '#7b1fa2' },
            { id: 'coop', name: 'Cooperation (合作關係)', color: '#0097a7' },
            { id: 'compete', name: 'Great Power Competition (大國競爭)', color: '#c2185b' }
        ];

        const SAMPLE_SENTENCES = [
            {
                id: 1,
                text: "中方依法采取必要措施维护自身主权，专业克制，无可非议。",
                date: "2012-06-15",
                source: "外交部發言稿",
                scores: { assertiveness: 0.75, coerciveness: 0.68, nationalism: 0.72, interest: 0.68, power: 0.58, coop: 0.25, compete: 0.62 }
            },
            {
                id: 2,
                text: "中菲兩國在經濟合作和人文交流方面有著廣泛的共同利益。",
                date: "2016-10-20",
                source: "人民日報",
                scores: { assertiveness: 0.35, coerciveness: 0.15, nationalism: 0.28, interest: 0.72, power: 0.32, coop: 0.85, compete: 0.18 }
            },
            {
                id: 3,
                text: "我們堅決反對任何國家對南海的非法主張和挑釁行為。",
                date: "2020-07-12",
                source: "外交部發言稿",
                scores: { assertiveness: 0.82, coerciveness: 0.58, nationalism: 0.88, interest: 0.75, power: 0.65, coop: 0.12, compete: 0.72 }
            },
            {
                id: 4,
                text: "中國致力於與東盟各國共同維護南海的和平與穩定。",
                date: "2018-03-08",
                source: "人民日報",
                scores: { assertiveness: 0.48, coerciveness: 0.22, nationalism: 0.42, interest: 0.65, power: 0.45, coop: 0.78, compete: 0.35 }
            },
            {
                id: 5,
                text: "菲律賓應當尊重國際法，停止在爭議地區的非法活動。",
                date: "2021-05-25",
                source: "外交部發言稿",
                scores: { assertiveness: 0.72, coerciveness: 0.68, nationalism: 0.65, interest: 0.70, power: 0.62, coop: 0.18, compete: 0.58 }
            }
        ];

        const ANOMALIES = [
            {
                date: "2012-06-15",
                severity: "high",
                type: "Escalation",
                description: "Scarborough Shoal incident - Significant increase in assertiveness (+0.26), coerciveness (+0.27), and decrease in cooperation (-0.36)",
                dimensions: { assertiveness: 0.68, coerciveness: 0.62, coop: 0.22 }
            },
            {
                date: "2016-10-20",
                severity: "high",
                type: "De-escalation",
                description: "Post-arbitration normalization - Dramatic increase in cooperation (+0.14), decrease in coerciveness (-0.27)",
                dimensions: { coop: 0.72, coerciveness: 0.08 }
            },
            {
                date: "2020-07-12",
                severity: "medium",
                type: "Strategic Repositioning",
                description: "South China Sea tensions - Increase in great power competition framing (+0.34), assertiveness (+0.16)",
                dimensions: { compete: 0.62, assertiveness: 0.58 }
            },
            {
                date: "2023-12-13",
                severity: "low",
                type: "Stabilization",
                description: "Return to balanced positioning - Cooperation emphasis increases, assertiveness moderates",
                dimensions: { coop: 0.55, assertiveness: 0.58 }
            }
        ];

        // ============ COMPONENT 1: TIMELINE EXPLORER ============
        let currentYear = 2014;

        function initTimeline() {
            const handle = document.getElementById('timelineHandle');
            const bar = document.getElementById('timelineBar');
            let isDragging = false;

            handle.addEventListener('mousedown', () => isDragging = true);
            document.addEventListener('mouseup', () => isDragging = false);

            bar.addEventListener('mousemove', (e) => {
                if (!isDragging) return;
                const rect = bar.getBoundingClientRect();
                const x = e.clientX - rect.left;
                const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
                
                handle.style.left = percentage + '%';
                currentYear = Math.round(2005 + (percentage / 100) * 19);
                
                document.getElementById('timelineLabel').textContent = currentYear;
                updateTimelineCharts();
                updateYearScores();
            });

            updateTimelineCharts();
            updateYearScores();
        }

        function updateTimelineCharts() {
            const yearIndex = currentYear - 2005;
            
            // Chart 1: Assertiveness & Coerciveness
            const trace1_assert = {
                x: YEARS,
                y: TEMPORAL_DATA.assertiveness,
                name: 'Assertiveness',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#1976d2', width: 2 },
                marker: { size: 6 }
            };
            
            const trace1_coerc = {
                x: YEARS,
                y: TEMPORAL_DATA.coerciveness,
                name: 'Coerciveness',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#d32f2f', width: 2 },
                marker: { size: 6 }
            };

            const layout1 = {
                title: '',
                xaxis: { title: 'Year' },
                yaxis: { title: 'Score', range: [0, 1] },
                hovermode: 'x unified',
                margin: { l: 50, r: 20, t: 20, b: 50 }
            };

            Plotly.newPlot('timelineChart1', [trace1_assert, trace1_coerc], layout1, { responsive: true });

            // Chart 2: Nationalism & Cooperation
            const trace2_nation = {
                x: YEARS,
                y: TEMPORAL_DATA.nationalism,
                name: 'Nationalism',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#f57c00', width: 2 },
                marker: { size: 6 }
            };
            
            const trace2_coop = {
                x: YEARS,
                y: TEMPORAL_DATA.coop,
                name: 'Cooperation',
                type: 'scatter',
                mode: 'lines+markers',
                line: { color: '#0097a7', width: 2 },
                marker: { size: 6 }
            };

            const layout2 = {
                title: '',
                xaxis: { title: 'Year' },
                yaxis: { title: 'Score', range: [0, 1] },
                hovermode: 'x unified',
                margin: { l: 50, r: 20, t: 20, b: 50 }
            };

            Plotly.newPlot('timelineChart2', [trace2_nation, trace2_coop], layout2, { responsive: true });
        }

        function updateYearScores() {
            const yearIndex = currentYear - 2005;
            let html = `<strong>${currentYear} Year Scores:</strong><br>`;
            DIMENSIONS.forEach(dim => {
                const score = TEMPORAL_DATA[dim.id][yearIndex];
                html += `${dim.name}: <span style="color: ${dim.color}; font-weight: bold;">${score.toFixed(2)}</span><br>`;
            });
            document.getElementById('yearScoresDisplay').innerHTML = html;
        }

        // ============ COMPONENT 2: DIMENSIONAL WEIGHT ADJUSTER ============
        const WEIGHTS = {
            assertiveness: 0.15,
            coerciveness: 0.15,
            nationalism: 0.12,
            interest: 0.15,
            power: 0.12,
            coop: 0.18,
            compete: 0.13
        };

        function initDimensionalAdjuster() {
            const container = document.getElementById('dimensionSliders');
            let html = '';
            
            DIMENSIONS.forEach(dim => {
                html += `
                    <div class="dimension-slider">
                        <div class="dimension-label">${dim.name}</div>
                        <input type="range" class="slider" id="slider_${dim.id}" 
                               min="0" max="100" value="${WEIGHTS[dim.id] * 100}" 
                               oninput="updatePPI()">
                        <div class="slider-value" id="value_${dim.id}">${(WEIGHTS[dim.id]).toFixed(2)}</div>
                    </div>
                `;
            });
            
            container.innerHTML = html;
            updatePPI();
        }

        function updatePPI() {
            let totalWeight = 0;
            let ppi = 0;
            
            DIMENSIONS.forEach(dim => {
                const slider = document.getElementById(`slider_${dim.id}`);
                const weight = parseInt(slider.value) / 100;
                WEIGHTS[dim.id] = weight;
                document.getElementById(`value_${dim.id}`).textContent = weight.toFixed(2);
                totalWeight += weight;
                
                // Use 2014 as reference year
                const yearIndex = 2014 - 2005;
                const score = TEMPORAL_DATA[dim.id][yearIndex];
                ppi += weight * score;
            });
            
            // Normalize
            ppi = ppi / totalWeight;
            
            document.getElementById('ppiValue').textContent = ppi.toFixed(2);
            
            let interpretation = '';
            if (ppi > 0.65) interpretation = 'Strong assertive positioning with emphasis on sovereignty';
            else if (ppi > 0.55) interpretation = 'Assertive positioning with balanced cooperation';
            else if (ppi > 0.45) interpretation = 'Balanced positioning between assertiveness and cooperation';
            else if (ppi > 0.35) interpretation = 'Cooperative positioning with moderate assertiveness';
            else interpretation = 'Strong cooperative positioning';
            
            document.getElementById('ppiInterpretation').textContent = interpretation;
            
            updateRadarChart();
        }

        function updateRadarChart() {
            const yearIndex = 2014 - 2005;
            const categories = DIMENSIONS.map(d => d.name.split('(')[0].trim());
            const values = DIMENSIONS.map(d => TEMPORAL_DATA[d.id][yearIndex]);
            
            const trace = {
                type: 'scatterpolar',
                r: values,
                theta: categories,
                fill: 'toself',
                name: '2014 Scores'
            };
            
            const layout = {
                polar: {
                    radialaxis: {
                        visible: true,
                        range: [0, 1]
                    }
                },
                margin: { l: 50, r: 50, t: 50, b: 50 }
            };
            
            Plotly.newPlot('dimensionRadar', [trace], layout, { responsive: true });
        }

        // ============ COMPONENT 3: SENTENCE SEARCH ============
        function performSearch() {
            const query = document.getElementById('sentenceSearch').value.toLowerCase();
            const resultsDiv = document.getElementById('searchResults');
            
            if (!query) {
                resultsDiv.innerHTML = '<p style="color: #999;">請輸入搜索詞</p>';
                return;
            }
            
            const results = SAMPLE_SENTENCES.filter(s => 
                s.text.toLowerCase().includes(query) || 
                s.source.toLowerCase().includes(query)
            );
            
            if (results.length === 0) {
                resultsDiv.innerHTML = '<p style="color: #999;">未找到相關句子</p>';
                return;
            }
            
            let html = `<p style="color: #666; margin-bottom: 15px;">找到 ${results.length} 個結果</p>`;
            results.forEach(result => {
                html += `
                    <div class="sentence-result" onclick="showDetailedScoring(${result.id})">
                        <div class="sentence-meta">${result.date} | ${result.source}</div>
                        <div class="sentence-text">${result.text}</div>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${DIMENSIONS.map(d => `
                                <span style="background: ${d.color}20; color: ${d.color}; padding: 4px 8px; border-radius: 4px; font-size: 0.85em;">
                                    ${d.name.split('(')[0].trim()}: ${result.scores[d.id].toFixed(2)}
                                </span>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        function showDetailedScoring(sentenceId) {
            const sentence = SAMPLE_SENTENCES.find(s => s.id === sentenceId);
            document.getElementById('detailedSentence').textContent = sentence.text;
            
            let html = '';
            DIMENSIONS.forEach(dim => {
                const score = sentence.scores[dim.id];
                html += `
                    <div style="margin-bottom: 20px; padding-bottom: 15px; border-bottom: 1px solid #eee;">
                        <div style="font-weight: 600; color: ${dim.color}; margin-bottom: 8px;">${dim.name}</div>
                        <div class="score-bar">
                            <div class="score-fill">
                                <div class="score-value" style="width: ${score * 100}%; background: ${dim.color};">
                                    ${score.toFixed(2)}
                                </div>
                            </div>
                        </div>
                        <p style="font-size: 0.9em; color: #666; margin-top: 8px;">
                            ${getScoreExplanation(dim.id, score)}
                        </p>
                    </div>
                `;
            });
            
            document.getElementById('detailedDimensionScores').innerHTML = html;
            document.getElementById('detailedScoring').style.display = 'block';
        }

        function getScoreExplanation(dimension, score) {
            const explanations = {
                assertiveness: score > 0.6 ? '強硬立場' : score > 0.4 ? '中等立場' : '溫和立場',
                coerciveness: score > 0.6 ? '高度脅迫性語言' : score > 0.4 ? '中等脅迫性' : '合作性語言',
                nationalism: score > 0.6 ? '強烈民族主義訴求' : score > 0.4 ? '中等民族主義' : '國際主義立場',
                interest: score > 0.6 ? '強調國家戰略利益' : score > 0.4 ? '中等利益強調' : '原則性立場',
                power: score > 0.6 ? '強調實力和能力' : score > 0.4 ? '中等實力參考' : '強調約束',
                coop: score > 0.6 ? '強調合作和對話' : score > 0.4 ? '中等合作意願' : '對抗性立場',
                compete: score > 0.6 ? '明確大國競爭框架' : score > 0.4 ? '隱含競爭意識' : '雙邊框架'
            };
            return explanations[dimension] || '評分說明';
        }

        function clearSearch() {
            document.getElementById('sentenceSearch').value = '';
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('detailedScoring').style.display = 'none';
        }

        // ============ COMPONENT 4: ANOMALY DETECTION ============
        let currentAnomalyFilter = 'all';

        function initAnomalyDetection() {
            displayAnomalies();
            displayAnomalyStats();
        }

        function filterAnomalies(severity) {
            currentAnomalyFilter = severity;
            displayAnomalies();
        }

        function displayAnomalies() {
            const filtered = currentAnomalyFilter === 'all' 
                ? ANOMALIES 
                : ANOMALIES.filter(a => a.severity === currentAnomalyFilter);
            
            let html = '';
            filtered.forEach(anomaly => {
                const alertClass = `alert-${anomaly.severity}`;
                html += `
                    <div class="alert-box ${alertClass}">
                        <div style="font-weight: 600; margin-bottom: 8px;">${anomaly.type} - ${anomaly.date}</div>
                        <div style="font-size: 0.95em; margin-bottom: 10px;">${anomaly.description}</div>
                        <div style="display: flex; gap: 15px; flex-wrap: wrap; font-size: 0.9em;">
                            ${Object.entries(anomaly.dimensions).map(([dim, score]) => `
                                <span><strong>${dim}:</strong> ${score.toFixed(2)}</span>
                            `).join('')}
                        </div>
                    </div>
                `;
            });
            
            document.getElementById('anomalyList').innerHTML = html;
        }

        function displayAnomalyStats() {
            const highCount = ANOMALIES.filter(a => a.severity === 'high').length;
            const mediumCount = ANOMALIES.filter(a => a.severity === 'medium').length;
            const lowCount = ANOMALIES.filter(a => a.severity === 'low').length;
            
            const html = `
                <div style="text-align: center; padding: 15px; background: white; border-radius: 6px;">
                    <div style="font-size: 1.8em; font-weight: bold; color: #d32f2f;">${highCount}</div>
                    <div style="font-size: 0.9em; color: #666;">High Severity</div>
                </div>
                <div style="text-align: center; padding: 15px; background: white; border-radius: 6px;">
                    <div style="font-size: 1.8em; font-weight: bold; color: #f57c00;">${mediumCount}</div>
                    <div style="font-size: 0.9em; color: #666;">Medium Severity</div>
                </div>
                <div style="text-align: center; padding: 15px; background: white; border-radius: 6px;">
                    <div style="font-size: 1.8em; font-weight: bold; color: #388e3c;">${lowCount}</div>
                    <div style="font-size: 0.9em; color: #666;">Low Severity</div>
                </div>
            `;
            
            document.getElementById('anomalyStats').innerHTML = html;
        }

        // ============ INITIALIZATION ============
        document.addEventListener('DOMContentLoaded', function() {
            initTimeline();
            initDimensionalAdjuster();
            initAnomalyDetection();
        });
    </script>
</body>

</html>
